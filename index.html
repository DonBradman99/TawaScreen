<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tawa Islamic Centre</title>
  <link rel="icon" href="logo.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
  <style>
    body {
      background-color: #f9f9f9;
      color: black;
      font-family: Arial, sans-serif;
      font-weight: bold;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: 4em;
      text-align: center;
      margin: 0.3em 0 0.2em;
      color: #003366;
    }
    #clock {
      text-align: center;
      font-size: 3.5em;
      color: #003366;
      margin-bottom: 10px;
      user-select: none;
    }
    #seconds {
      display: none;
    }
    #prayer-times {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 2em;
      gap: 10px;
      margin-top: 10px;
    }
    .highlight {
      background-color: #003366;
      color: white;
      padding: 5px 10px;
      border-radius: 8px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0, 51, 102, 0.6); }
      70% { box-shadow: 0 0 10px 10px rgba(0, 51, 102, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 51, 102, 0); }
    }
  </style>
</head>
<body>

  <h1>Tawa Islamic Centre</h1>
  <div id="clock">
    <span id="hours"></span>:<span id="minutes"></span>
    <div id="seconds"></div>
  </div>
  <div id="prayer-times">Loading...</div>

  <script>
    function updateClock() {
      const now = new Date();
      let h = now.getHours();
      let m = now.getMinutes();
      h = h % 12 || 12;
      document.getElementById('hours').textContent = h.toString().padStart(2, '0');
      document.getElementById('minutes').textContent = m.toString().padStart(2, '0');
    }

    async function fetchPrayerTimes() {
      const sheetID = '1AunLHACQEUcIeIrcwXafAEpVn1dq39gLGJVIyL8QzV0';
      const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=Sheet1`;

      try {
        const res = await fetch(url);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        const today = new Date();
        const todayStr = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;

        const row = rows.find(r => {
          const cell = r.c[0];
          if (!cell) return false;
          const date = cell.f || cell.v;
          return date === todayStr;
        });

        if (!row) {
          document.getElementById("prayer-times").textContent = "No data for today.";
          return;
        }

        const names = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
        const times = row.c.slice(1).map(c => c?.f || c?.v || '');

        const now = new Date();
        const prayerDates = times.map(t => {
          const [h, m] = t.split(':').map(Number);
          return new Date(today.getFullYear(), today.getMonth(), today.getDate(), h, m);
        });

        let nextIndex = prayerDates.findIndex(pt => pt > now);
        if (nextIndex === -1) nextIndex = 0;

        const html = names.map((name, i) => `
          <div class="${i === nextIndex ? 'highlight' : ''}">
            <div>${name}</div>
            <div>${times[i]}</div>
          </div>
        `).join('');

        document.getElementById("prayer-times").innerHTML = html;

      } catch (e) {
        console.error(e);
        document.getElementById("prayer-times").textContent = "Error loading times.";
      }
    }

    updateClock();
    fetchPrayerTimes();
    setInterval(updateClock, 1000);
    setInterval(fetchPrayerTimes, 60000);
  </script>
</body>
</html>
